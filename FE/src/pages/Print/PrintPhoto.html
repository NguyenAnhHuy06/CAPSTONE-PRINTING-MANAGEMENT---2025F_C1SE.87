<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>High Quality Photo Printing</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
         :root {
            --bg: #f7f8fb;
            --card: #fff;
            --muted: #8b95a1;
            --accent: #556ee6;
            --panel: #f2f4f7;
            --border: #dcdfe6;
        }
        
        * {
            box-sizing: border-box
        }
        
        body {
            font-family: Inter, system-ui, Arial;
            background: var(--bg);
            margin: 0;
            padding: 24px;
            color: #222;
            -webkit-font-smoothing: antialiased;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--card);
            border-radius: 10px;
            padding: 26px;
            box-shadow: 0 6px 18px rgba(20, 30, 60, 0.06);
        }
        /* header */
        
        .page-header {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 10px
        }
        
        .btn-back {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            padding: 6px 8px;
            border-radius: 6px
        }
        
        .btn-back:hover {
            background: #f1f6ff
        }
        
        .title-wrap h1 {
            margin: 0;
            font-size: 20px;
            font-weight: 600
        }
        
        .title-wrap p {
            margin: 6px 0 0;
            color: var(--muted);
            font-size: 13px
        }
        /* layout */
        
        .layout {
            display: flex;
            gap: 18px;
            align-items: flex-start
        }
        
        .left {
            flex: 1
        }
        
        .right {
            width: 300px;
            flex-shrink: 0
        }
        /* sections */
        
        .section {
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 16px;
            background: #fff;
            margin-bottom: 16px
        }
        
        .section h3 {
            margin: 0 0 10px;
            font-size: 15px
        }
        
        .row {
            display: flex;
            gap: 12px
        }
        
        .col {
            flex: 1
        }
        
        input[type="text"],
        input[type="email"],
        textarea,
        select,
        input[type="number"] {
            border: 1px solid #e4e7eb;
            border-radius: 8px;
            padding: 8px 10px;
            font-size: 13px;
            width: 100%;
            background: #fbfcfe;
        }
        
        textarea {
            min-height: 64px;
            resize: vertical
        }
        /* upload area */
        
        .upload-area {
            border: 2px dashed var(--border);
            border-radius: 10px;
            padding: 28px;
            text-align: center;
            background: linear-gradient(180deg, #fff, #fbfdff)
        }
        
        .upload-area .icon {
            font-size: 28px;
            color: var(--muted);
            margin-bottom: 8px
        }
        
        .upload-area p {
            margin: 6px 0;
            color: var(--muted);
            font-size: 13px
        }
        
        .file-input-row {
            display: flex;
            justify-content: center;
            margin-top: 10px;
            gap: 10px;
            align-items: center
        }
        
        .file-input {
            padding: 6px 10px;
            border-radius: 8px;
            border: 1px solid #e4e7eb;
            background: #f2f6ff;
            cursor: pointer
        }
        
        .file-names {
            font-size: 13px;
            color: var(--muted);
            margin-top: 8px;
            text-align: left
        }
        /* config list */
        
        .config-list-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px
        }
        
        .file-card {
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 10px 12px;
            background: #fff;
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
            transition: all .18s ease;
        }
        
        .file-card .top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }
        
        .file-left {
            display: flex;
            gap: 10px;
            align-items: center
        }
        
        .thumb {
            width: 44px;
            height: 44px;
            border-radius: 6px;
            background: #f0f2f5;
            object-fit: cover;
            border: 1px solid #e8ebef;
        }
        
        .meta {
            font-size: 13px
        }
        
        .meta strong {
            display: block;
            font-weight: 600
        }
        
        .meta .sub {
            color: var(--muted);
            font-size: 12px;
            margin-top: 4px
        }
        
        .remove-x {
            color: #e75b6b;
            cursor: pointer;
            padding: 6px;
            border-radius: 6px
        }
        
        .expand-arrow {
            cursor: pointer;
            color: var(--muted);
            padding: 6px;
            border-radius: 6px
        }
        
        .file-summary-line {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 8px;
            color: var(--muted);
            font-size: 13px
        }
        /* details area hidden by default */
        
        .details {
            display: none;
            margin-top: 10px;
            border-top: 1px dashed #eef2f5;
            padding-top: 10px
        }
        
        .details .row {
            align-items: center
        }
        
        .price-badge {
            font-weight: 700;
            color: #0b1220
        }
        /* paper options */
        
        .paper-type {
            display: flex;
            gap: 8px;
            margin-top: 8px;
            flex-wrap: wrap
        }
        
        .chip {
            border-radius: 999px;
            padding: 6px 8px;
            border: 1px solid #e4e7eb;
            font-size: 12px;
            color: var(--muted);
            background: #fbfdff
        }
        
        .chip.active {
            background: #eef3ff;
            border-color: #d7e0ff;
            color: #234
        }
        
        .footer-note {
            font-size: 12px;
            color: var(--muted);
            margin-top: 8px
        }
        /* order summary right */
        
        .order-summary-box {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 16px;
            background-color: #fff;
            max-width: 300px;
            /* giữ khung không bị vỡ */
            word-wrap: break-word;
        }
        
        .order-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            background: #f8f9fb;
            border-radius: 8px;
            padding: 8px 10px;
            margin-bottom: 8px;
            overflow: hidden;
        }
        
        .order-item .thumb {
            width: 38px;
            height: 38px;
            border-radius: 6px;
            object-fit: cover;
            flex-shrink: 0;
        }
        
        .order-item .o-meta {
            flex: 1;
            min-width: 0;
            /* fix lỗi tràn text */
        }
        
        .order-item .o-price {
            flex-shrink: 0;
            white-space: nowrap;
            text-align: right;
            font-weight: 600;
        }
        
        .summary-footer {
            border-top: 1px solid #eef2f5;
            padding-top: 12px;
            margin-top: 6px
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--muted);
            font-size: 14px;
            margin-bottom: 6px
        }
        
        .pay-btn {
            display: block;
            margin: 12px auto 0;
            width: 100%;
            text-align: center;
            background: #556ee6;
            color: #fff;
            border: none;
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600
        }
        
        .pay-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed
        }
        /* responsive */
        
        @media (max-width:960px) {
            .layout {
                flex-direction: column
            }
            .right {
                width: 100%
            }
            .order-summary {
                position: relative;
                top: auto
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="page-header">
            <button class="btn-back" onclick="window.history.back()">←</button>
            <div class="title-wrap">
                <h1>High Quality Photo Printing</h1>
                <p>Upload your photo and choose size and paper type</p>
            </div>
        </div>

        <div class="layout">
            <div class="left">
                <!-- Customer Info -->
                <div class="section">
                    <h3>Customer Information</h3>
                    <div class="row">
                        <div class="col">
                            <label>Full Name *</label>
                            <input type="text" placeholder="Enter full name" id="custName">
                        </div>
                        <div class="col">
                            <label>Email *</label>
                            <input type="email" placeholder="Enter email" id="custEmail">
                        </div>
                    </div>
                </div>

                <!-- Upload -->
                <div class="section">
                    <h3>Upload photos</h3>
                    <div class="upload-area" id="uploadArea">
                        <div class="icon">📤</div>
                        <p style="font-weight:600; margin:6px 0 4px">Select image to print</p>
                        <p style="margin:0 0 8px;color:var(--muted); font-size:13px">Supports JPG, PNG, TIFF (max 20MB per image, minimum resolution 300 DPI)</p>
                        <div class="file-input-row">
                            <label class="file-input">
              <input id="fileInput" type="file" accept="image/*" multiple style="display:none">
              <span id="chooseText">Choose Files</span>
            </label>
                            <small style="color:var(--muted); font-size:13px" id="fileNames"></small>
                        </div>
                        <div class="file-names" id="filePreviewSmall"></div>
                    </div>
                </div>

                <!-- Special request -->
                <div class="section">
                    <h3>Special request</h3>
                    <label>Additional notes (optional)</label>
                    <textarea id="notes" placeholder="For example: crop to ratio, adjust colors, deliver to another address..."></textarea>
                </div>

                <!-- Configure print -->
                <div class="section" id="configSection" style="display:none">
                    <div class="config-list-title">⚙️ Configure print photos (<span id="countLabel">0 files</span>)</div>
                    <div id="configList"></div>
                </div>
            </div>

            <div class="right">
                <div class="order-summary">
                    <h4>Order Summary</h4>
                    <div id="orderList">
                        <p style="color:var(--muted); text-align:center">No files uploaded yet</p>
                    </div>

                    <div class="summary-footer">
                        <div class="summary-row">
                            <div>Number of file:</div>
                            <div id="orderCount">0 photos</div>
                        </div>
                        <div class="summary-row">
                            <div style="font-weight:700">Total:</div>
                            <div id="orderTotal">0₫</div>
                        </div>
                        <button id="payBtn" class="pay-btn" disabled>Proceed with payment</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* JS logic:
                                 - handle file input
                                 - create file items with thumbnail, defaults: copies=1, size='10 x 15 (Standard photo)', paper=Glossy
                                 - price calculation: base price map by size; paper extra; borderless (+10%); copies multiplies
                                 - render config list (collapsible details) and order summary (right)
                                */

        const fileInput = document.getElementById('fileInput');
        const chooseText = document.getElementById('chooseText');
        const fileNames = document.getElementById('fileNames');
        const filePreviewSmall = document.getElementById('filePreviewSmall');
        const configSection = document.getElementById('configSection');
        const configList = document.getElementById('configList');
        const countLabel = document.getElementById('countLabel');

        const orderList = document.getElementById('orderList');
        const orderCount = document.getElementById('orderCount');
        const orderTotal = document.getElementById('orderTotal');
        const payBtn = document.getElementById('payBtn');

        let items = [];

        // pricing tables (VND)
        const basePrice = {
            '10x15': 5500,
            '13x18': 8800,
            '15x20': 16500
        };
        const paperExtra = {
            'Glossy': 0,
            'Matte': 2000,
            'Premium': 4000
        };
        const BORDERLESS_MULT = 0.10; // +10%

        // helper to format
        function fmt(v) {
            return v.toLocaleString() + 'đ';
        }

        function shortName(name, n = 30) {
            return name.length > n ? name.slice(0, n - 3) + '...' : name;
        }

        // handle file chooser text click to open file dialog
        document.querySelector('.file-input').addEventListener('click', () => fileInput.click());

        fileInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            if (!files.length) return;

            files.forEach(f => {
                const id = Date.now().toString(36) + Math.random().toString(36).slice(2, 8);
                const url = URL.createObjectURL(f);
                const item = {
                    id,
                    name: f.name,
                    preview: url,
                    pages: 1,
                    copies: 1,
                    size: '10x15', // key in basePrice
                    sizeLabel: '10 x 15 (Standard photo)',
                    paper: 'Glossy',
                    borderless: false,
                    price: 0
                };
                items.push(item);
            });

            // show chosen names
            fileNames.textContent = items.map(i => i.name).join(', ');
            filePreviewSmall.innerHTML = items.map(i => `<div style="display:inline-block;margin-right:10px"><img src="${i.preview}" style="width:40px;height:40px;border-radius:6px;object-fit:cover;border:1px solid #e8ebef"></div>`).join('');
            renderAll();
        });

        // calculate price per item
        function calcPrice(it) {
            const base = basePrice[it.size] || basePrice['10x15'];
            const pExtra = paperExtra[it.paper] || 0;
            let p = (base + pExtra) * it.copies;
            if (it.borderless) p = Math.round(p * (1 + BORDERLESS_MULT));
            return p;
        }

        function renderAll() {
            // show config section
            configSection.style.display = items.length ? 'block' : 'none';
            countLabel.textContent = `${items.length} ${items.length>1?'files':'file'}`;

            // render config list
            configList.innerHTML = '';
            items.forEach(it => {
                it.price = calcPrice(it);
                const card = document.createElement('div');
                card.className = 'file-card';
                card.id = 'card-' + it.id;
                card.innerHTML = `
      <div class="top">
        <div class="file-left">
          <img class="thumb" src="${it.preview}" alt="">
          <div class="meta">
            <strong>${shortName(it.name,40)}</strong>
            <div class="sub">${it.sizeLabel} • ${it.copies} copy${it.copies>1?'s':''} • ${fmt(it.price)}</div>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <div class="remove-x" data-id="${it.id}" title="Remove">✖</div>
          <div class="expand-arrow" data-id="${it.id}" title="Toggle details">▾</div>
        </div>
      </div>
      <div class="details" id="details-${it.id}">
        <div class="row">
          <div style="flex:0 0 110px">
            <label>Number of copies</label>
            <input type="number" min="1" value="${it.copies}" data-field="copies" data-id="${it.id}" style="width:100%;margin-top:6px">
          </div>
          <div style="flex:1">
            <label>Paper size</label>
            <select data-field="size" data-id="${it.id}" style="margin-top:6px">
              <option value="10x15" ${it.size==='10x15'?'selected':''}>10 x 15 cm (Standard photo)</option>
              <option value="13x18" ${it.size==='13x18'?'selected':''}>13 x 18 cm</option>
              <option value="15x20" ${it.size==='15x20'?'selected':''}>15 x 20 cm</option>
            </select>
          </div>
          <div style="flex:0 0 140px">
            <label>Paper type</label>
            <div style="margin-top:6px">
              <label style="margin-right:6px"><input type="radio" name="paper-${it.id}" value="Glossy" ${it.paper==='Glossy'?'checked':''}> Glossy</label><br>
              <label style="margin-right:6px"><input type="radio" name="paper-${it.id}" value="Matte" ${it.paper==='Matte'?'checked':''}> Matte (+2.000đ)</label><br>
              <label style="margin-right:6px"><input type="radio" name="paper-${it.id}" value="Premium" ${it.paper==='Premium'?'checked':''}> Premium (+4.000đ)</label>
            </div>
          </div>
        </div>

        <div style="margin-top:10px; display:flex; align-items:center; gap:12px">
          <label><input type="checkbox" data-field="borderless" data-id="${it.id}" ${it.borderless?'checked':''}> Borderless (+10%)</label>
          <div style="flex:1"></div>
          <div style="font-weight:700">${fmt(it.price)}</div>
        </div>
        <div class="footer-note">The photo will be printed full size, with no white borders around it.</div>
      </div>
    `;
                configList.appendChild(card);
            });

            // attach event listeners (delegation)
            // remove
            configList.querySelectorAll('.remove-x').forEach(el => {
                el.onclick = (ev) => {
                    const id = el.getAttribute('data-id');
                    removeItem(id);
                };
            });
            // expand
            configList.querySelectorAll('.expand-arrow').forEach(el => {
                el.onclick = () => {
                    const id = el.getAttribute('data-id');
                    toggleDetails(id);
                };
            });
            // inputs change
            configList.querySelectorAll('input[type="number"]').forEach(inp => {
                inp.oninput = (ev) => {
                    const id = inp.getAttribute('data-id');
                    const val = Math.max(1, parseInt(inp.value) || 1);
                    const idx = items.findIndex(x => x.id === id);
                    if (idx > -1) {
                        items[idx].copies = val;
                        updateItem(idx);
                    }
                };
            });
            configList.querySelectorAll('select[data-field="size"]').forEach(sel => {
                sel.onchange = () => {
                    const id = sel.getAttribute('data-id');
                    const idx = items.findIndex(x => x.id === id);
                    if (idx > -1) {
                        items[idx].size = sel.value;
                        items[idx].sizeLabel = sel.options[sel.selectedIndex].text;
                        updateItem(idx);
                    }
                };
            });
            // paper radio
            configList.querySelectorAll('input[type="radio"]').forEach(r => {
                r.onchange = () => {
                    const name = r.name; // paper-<id>
                    if (!name.startsWith('paper-')) return;
                    const id = name.split('-')[1];
                    const idx = items.findIndex(x => x.id === id);
                    if (idx > -1) {
                        items[idx].paper = r.value;
                        updateItem(idx);
                    }
                };
            });
            // borderless checkboxes
            configList.querySelectorAll('input[type="checkbox"][data-field="borderless"]').forEach(cb => {
                cb.onchange = () => {
                    const id = cb.getAttribute('data-id');
                    const idx = items.findIndex(x => x.id === id);
                    if (idx > -1) {
                        items[idx].borderless = cb.checked;
                        updateItem(idx);
                    }
                };
            });

            // update order summary
            renderOrderSummary();
        }

        // toggle details open/close
        function toggleDetails(id) {
            const det = document.getElementById('details-' + id);
            const card = document.getElementById('card-' + id);
            if (!det) return;
            const isVisible = det.style.display === 'block';
            det.style.display = isVisible ? 'none' : 'block';
            // rotate arrow - use text symbol flip
            const arr = card.querySelector('.expand-arrow');
            arr.textContent = isVisible ? '▾' : '▴';
        }

        // remove item
        function removeItem(id) {
            items = items.filter(x => x.id !== id);
            renderAll();
        }

        // update single item after change
        function updateItem(idx) {
            items[idx].price = calcPrice(items[idx]);
            renderAll();
        }

        // calculate price helper
        function calcPrice(it) {
            const base = basePrice[it.size] || basePrice['10x15'];
            const extra = paperExtra[it.paper] || 0;
            let p = (base + extra) * it.copies;
            if (it.borderless) p = Math.round(p * (1 + BORDERLESS_MULT));
            return p;
        }

        // render order summary (right)
        function renderOrderSummary() {
            orderList.innerHTML = '';
            let total = 0;
            if (items.length === 0) {
                orderList.innerHTML = `<p style="color:var(--muted); text-align:center">No files uploaded yet</p>`;
                orderCount.textContent = '0 photos';
                orderTotal.textContent = '0₫';
                payBtn.disabled = true;
                return;
            }

            items.forEach(it => {
                it.price = calcPrice(it);
                total += it.price;
                const row = document.createElement('div');
                row.className = 'order-item';
                row.innerHTML = `
      <img class="thumb" src="${it.preview}" alt="">
      <div class="o-meta">
        <div style="font-weight:600">${shortName(it.name,28)}</div>
        <div style="font-size:12px;color:var(--muted); margin-top:6px">${it.sizeLabel} • ${it.copies} copy${it.copies>1?'s':''}<br>${it.paper}${it.borderless? ' • Borderless':''}</div>
      </div>
      <div class="o-price">${fmt(it.price)}</div>
    `;
                orderList.appendChild(row);
            });

            orderCount.textContent = `${items.length} photos`;
            orderTotal.textContent = fmt(total);
            payBtn.disabled = false;
            // scroll behaviour if many items
            orderList.style.maxHeight = items.length > 4 ? '360px' : 'auto';
            orderList.style.overflowY = items.length > 4 ? 'auto' : 'visible';
        }

        // helper price constants accessible in calc functions


        // pay button demo
        payBtn.addEventListener('click', () => {
            const total = items.reduce((s, i) => s + calcPrice(i), 0);
            alert(`Proceed to payment\nTotal: ${fmt(total)}\nFiles: ${items.length}`);
        });

        // cleanup object URLs on unload
        window.addEventListener('unload', () => {
            items.forEach(i => {
                try {
                    URL.revokeObjectURL(i.preview);
                } catch (e) {}
            });
        });
    </script>
</body>

</html>